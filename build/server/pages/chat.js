"use strict";(()=>{var a={};a.id=106,a.ids=[106,220],a.modules={361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},757:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>j,getServerSideProps:()=>k});var e=c(8732),f=c(2015),g=c(5806),h=c(8403),i=a([h]);function j({user:a}){let[b,c]=(0,f.useState)(""),[d,g]=(0,f.useState)([]),[h,i]=(0,f.useState)(!1),j=async()=>{if(!b.trim()||h)return;i(!0);let a={role:"user",content:b};g(b=>[...b,a]),c("");try{let a=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:b})}),c=await a.json();if(a.ok)g(a=>[...a,{role:"assistant",content:c.response}]);else throw Error(c.error)}catch(a){console.error("Error:",a),g(a=>[...a,{role:"assistant",content:"Sorry, I encountered an error. Please try again."}])}finally{i(!1)}};return(0,e.jsxs)("div",{style:{padding:"2rem",maxWidth:"800px",margin:"0 auto"},children:[(0,e.jsx)("h1",{children:"AI Chat"}),(0,e.jsxs)("div",{style:{border:"1px solid #ccc",height:"400px",overflowY:"auto",padding:"1rem"},children:[d.map((a,b)=>(0,e.jsxs)("div",{style:{marginBottom:"1rem",textAlign:"user"===a.role?"right":"left"},children:[(0,e.jsxs)("strong",{children:["user"===a.role?"You":"AI",":"]}),(0,e.jsx)("p",{children:a.content})]},b)),h&&(0,e.jsx)("div",{children:"Thinking..."})]}),(0,e.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,e.jsx)("input",{type:"text",value:b,onChange:a=>c(a.target.value),onKeyPress:a=>"Enter"===a.key&&j(),placeholder:"Type your message...",style:{width:"70%",padding:"0.5rem"}}),(0,e.jsx)("button",{onClick:j,disabled:h,style:{padding:"0.5rem 1rem",marginLeft:"0.5rem"},children:"Send"})]})]})}async function k(a){let b=await (0,g.getServerSession)(a.req,a.res,h.N);return b?{props:{user:b.user}}:{redirect:{destination:"/auth/signin",permanent:!1}}}h=(i.then?(await i)():i)[0],d()}catch(a){d(a)}})},2015:a=>{a.exports=require("react")},3139:a=>{a.exports=import("bcryptjs")},3873:a=>{a.exports=require("path")},5542:a=>{a.exports=require("next-auth")},5806:a=>{a.exports=require("next-auth/next")},6060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},6184:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>s,default:()=>o,getServerSideProps:()=>r,getStaticPaths:()=>q,getStaticProps:()=>p,handler:()=>A,reportWebVitals:()=>t,routeModule:()=>z,unstable_getServerProps:()=>x,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>u});var e=c(3885),f=c(237),g=c(1413),h=c(3317),i=c.n(h),j=c(6195),k=c.n(j),l=c(757),m=c(2289),n=a([l]);l=(n.then?(await n)():n)[0];let o=(0,g.M)(l,"default"),p=(0,g.M)(l,"getStaticProps"),q=(0,g.M)(l,"getStaticPaths"),r=(0,g.M)(l,"getServerSideProps"),s=(0,g.M)(l,"config"),t=(0,g.M)(l,"reportWebVitals"),u=(0,g.M)(l,"unstable_getStaticProps"),v=(0,g.M)(l,"unstable_getStaticPaths"),w=(0,g.M)(l,"unstable_getStaticParams"),x=(0,g.M)(l,"unstable_getServerProps"),y=(0,g.M)(l,"unstable_getServerSideProps"),z=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/chat",pathname:"/chat",bundlePath:"",filename:""},distDir:"build",relativeProjectDir:"",components:{App:k(),Document:i()},userland:l}),A=(0,m.U)({srcPage:"/chat",config:s,userland:l,routeModule:z,getStaticPaths:q,getStaticProps:p,getServerSideProps:r});d()}catch(a){d(a)}})},6330:a=>{a.exports=require("@prisma/client")},6382:a=>{a.exports=require("next-auth/providers/credentials")},8403:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{N:()=>n});var e=c(5542),f=c.n(e),g=c(6382),h=c.n(g),i=c(8689),j=c(6330),k=c(3139),l=a([k]);k=(l.then?(await l)():l)[0];let m=globalThis.prisma;m||(m=new j.PrismaClient);let n={adapter:(0,i.PrismaAdapter)(m),providers:[h()({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(a){try{if(!a?.email||!a?.password)throw Error("邮箱和密码不能为空");let b=await m.user.findUnique({where:{email:a.email}});if(!b)throw Error("用户不存在");if(!b.password)throw Error("用户密码未设置");if(!await k.default.compare(a.password,b.password))throw Error("密码错误");return{id:b.id,email:b.email,name:b.name}}catch(a){return console.error("认证错误:",a.message),null}}})],session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/auth/signin",signUp:"/auth/signup",error:"/auth/error"},callbacks:{jwt:async({token:a,user:b})=>(b&&(a.id=b.id),a),session:async({session:a,token:b})=>(b&&(a.user.id=b.id),a)},debug:!1};f()(n),d()}catch(a){d(a)}})},8689:a=>{a.exports=require("@next-auth/prisma-adapter")},8732:a=>{a.exports=require("react/jsx-runtime")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[317,871],()=>b(b.s=6184));module.exports=c})();